.page-header
  %h1.title
    = @subject.name
    - if @subject.dm_only?
      - if current_user.dm?
        = locked_icon
      - elsif can?(:read, @subject)
        = unlocked_icon
    - elsif @subject.authorized_users.include?(current_user)
      = unlocked_icon
= render_wiki(@subject.text)


= content_for(:sidebar) do
  - @subject.attachments.each do |attachment|
    - if attachment == @subject.attachments.first
      %h4
        Attachments
        %i.icon-paper-clip
    = link_to(attachment.attachment.url) do
      - if attachment.image? # TODO set default url
        = image_tag(attachment.attachment.thumb.url, :class => "img-polaroid")
      %span<>
        = File.basename(attachment.attachment.path, File.extname(attachment.attachment.path)).humanize
    = attachment_metadata(attachment)

    - unless attachment == @subject.attachments.last
      %div{style: "margin-top: 4px"} Â 


- if @subject.veil_passes.present? && can?(:read, VeilPass)
  = content_for(:sidebar) do
    %h4
      Veil Passes
      %i.icon-key
    %ul
      = list_of(@subject.veil_passes.joins(:user).order(:users => [:first_name, :last_name])) do |vp|
        = vp.user_name


- if can?(:update, Subject) || can?(:destroy, Subject)
  = content_for(:sidebar) do
    %h4
      Actions
      %i.icon-wrench
    %ul.nav.nav-tabs.nav-stacked
      - if can?(:update, Subject)
        %li
          = link_to(edit_subject_path(@subject)) do
            %i.icon-pencil
            Edit
      - if can?(:destroy, Subject)
        %li
          = link_to(subject_path(@subject),
                    :method => :delete, :confirm => "Are you sure?") do
            %i.icon-remove
            Delete
